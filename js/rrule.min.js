(function(T){var ba="undefined"!==typeof module&&module.exports,C=function(){if(!C._nlp)if(ba)C._nlp=require("./nlp");else if(!(C._nlp=T._RRuleNLP))throw Error("You need to include rrule/nlp.js for fromText/toText to work.");return C._nlp},n={MONTH_DAYS:[31,28,31,30,31,30,31,31,30,31,30,31],ONE_DAY:864E5,MAXYEAR:9999,ORDINAL_BASE:new Date(1970,0,1),PY_WEEKDAYS:[6,0,1,2,3,4,5],getYearDay:function(a){var c=new Date(a.getFullYear(),a.getMonth(),a.getDate());return Math.ceil((c-new Date(a.getFullYear(),
0,1))/n.ONE_DAY)+1},isLeapYear:function(a){a instanceof Date&&(a=a.getFullYear());return 0===a%4&&0!==a%100||0===a%400},tzOffset:function(a){return 6E4*a.getTimezoneOffset()},daysBetween:function(a,c){var d=a.getTime()-n.tzOffset(a),e=c.getTime()-n.tzOffset(c),d=Math.abs(d-e);return Math.round(d/n.ONE_DAY)},toOrdinal:function(a){return n.daysBetween(a,n.ORDINAL_BASE)},fromOrdinal:function(a){a*=n.ONE_DAY;return new Date(n.ORDINAL_BASE.getTime()-n.tzOffset(n.ORDINAL_BASE)+a+n.tzOffset(new Date(a)))},
monthRange:function(a,c){var d=new Date(a,c,1);return[n.getWeekday(d),n.getMonthDays(d)]},getMonthDays:function(a){var c=a.getMonth();return 1==c&&n.isLeapYear(a)?29:n.MONTH_DAYS[c]},getWeekday:function(a){return n.PY_WEEKDAYS[a.getDay()]},combine:function(a,c){c=c||a;return new Date(a.getFullYear(),a.getMonth(),a.getDate(),c.getHours(),c.getMinutes(),c.getSeconds())},clone:function(a){a=new Date(a.getTime());a.setMilliseconds(0);return a},cloneDates:function(a){for(var c=[],d=0;d<a.length;d++)c.push(n.clone(a[d]));
return c},sort:function(a){a.sort(function(a,d){return a.getTime()-d.getTime()})},timeToUntilString:function(a){a=new Date(a);for(var c=[a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),"T",a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),"Z"],d=0;d<c.length;d++)a=c[d],!/[TZ]/.test(a)&&10>a&&(c[d]="0"+String(a));return c.join("")},untilStringToDate:function(a){var c=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z)?$/.exec(a);if(!c)throw Error("Invalid UNTIL value: "+a);return new Date(Date.UTC(c[1],
c[2]-1,c[3],c[5]||0,c[6]||0,c[7]||0))},Time:function(a,c,d){this.hour=a;this.minute=c;this.second=d}};n.Time.prototype={getHours:function(){return this.hour},getMinutes:function(){return this.minute},getSeconds:function(){return this.second},getTime:function(){return 1E3*(3600*this.hour+60*this.minute+this.second)}};var E=function(a,c){1===arguments.length&&(c=a,a=0);for(var d=[],e=a;e<c;e++)d.push(e);return d},p=function(a,c){var d=0,e=[];if(a instanceof Array)for(;d<c;d++)e[d]=[].concat(a);else for(;d<
c;d++)e[d]=a;return e},D=function(a,c){var d=a%c;return 0>d*c?d+c:d},O=function(a,c){return{div:Math.floor(a/c),mod:D(a,c)}},v=function(a){return a instanceof Array&&0==a.length?!1:Boolean(a)},w=function(a,c){return-1!=a.indexOf(c)},ga=[].concat(p(1,31),p(2,28),p(3,31),p(4,30),p(5,31),p(6,30),p(7,31),p(8,31),p(9,30),p(10,31),p(11,30),p(12,31),p(1,7)),ha=[].concat(p(1,31),p(2,29),p(3,31),p(4,30),p(5,31),p(6,30),p(7,31),p(8,31),p(9,30),p(10,31),p(11,30),p(12,31),p(1,7)),U=E(1,29),P=E(1,30),y=E(1,31),
m=E(1,32),ia=[].concat(m,P,m,y,m,y,m,m,y,m,y,m,m.slice(0,7)),ja=[].concat(m,U,m,y,m,y,m,m,y,m,y,m,m.slice(0,7)),U=E(-28,0),P=E(-29,0),y=E(-30,0),m=E(-31,0),ka=[].concat(m,P,m,y,m,y,m,m,y,m,y,m,m.slice(0,7)),la=[].concat(m,U,m,y,m,y,m,m,y,m,y,m,m.slice(0,7)),ma=[0,31,60,91,121,152,182,213,244,274,305,335,366],na=[0,31,59,90,120,151,181,212,243,273,304,334,365],fa=function(){for(var a=[],c=0;55>c;c++)a=a.concat(E(7));return a}(),B=function(a,c){if(0===c)throw Error("Can't create weekday with n == 0");
this.weekday=a;this.n=c};B.prototype={nth:function(a){return this.n==a?this:new B(this.weekday,a)},equals:function(a){return this.weekday==a.weekday&&this.n==a.n},toString:function(){var a="MO TU WE TH FR SA SU".split(" ")[this.weekday];this.n&&(a=(0<this.n?"+":"")+String(this.n)+a);return a},getJsWeekday:function(){return 6==this.weekday?0:this.weekday+1}};var h=function(a,c){this._string=null;a=a||{};this._cache=c?null:{all:!1,before:[],after:[],between:[]};this.origOptions={};var d=[],e=Object.keys(a),
g=Object.keys(h.DEFAULT_OPTIONS);e.forEach(function(b){this.origOptions[b]=a[b];w(g,b)||d.push(b)},this);if(d.length)throw Error("Invalid options: "+d.join(", "));if(!h.FREQUENCIES[a.freq]&&null===a.byeaster)throw Error("Invalid frequency: "+String(a.freq));g.forEach(function(b){w(e,b)||(a[b]=h.DEFAULT_OPTIONS[b])});var b=this.options=a;null!==b.byeaster&&(b.freq=h.YEARLY);b.dtstart||(b.dtstart=new Date,b.dtstart.setMilliseconds(0));null===b.wkst?b.wkst=h.MO.weekday:"number"!=typeof b.wkst&&(b.wkst=
b.wkst.weekday);if(null!==b.bysetpos){"number"==typeof b.bysetpos&&(b.bysetpos=[b.bysetpos]);for(var f=0;f<b.bysetpos.length;f++){var l=b.bysetpos[f];if(0==l||!(-366<=l&&366>=l))throw Error("bysetpos must be between 1 and 366, or between -366 and -1");}}if(!(v(b.byweekno)||v(b.byyearday)||v(b.bymonthday)||null!==b.byweekday||null!==b.byeaster))switch(b.freq){case h.YEARLY:b.bymonth||(b.bymonth=b.dtstart.getMonth()+1);b.bymonthday=b.dtstart.getDate();break;case h.MONTHLY:b.bymonthday=b.dtstart.getDate();
break;case h.WEEKLY:b.byweekday=n.getWeekday(b.dtstart)}null===b.bymonth||b.bymonth instanceof Array||(b.bymonth=[b.bymonth]);null===b.byyearday||b.byyearday instanceof Array||(b.byyearday=[b.byyearday]);if(null===b.bymonthday)b.bymonthday=[],b.bynmonthday=[];else if(b.bymonthday instanceof Array){for(var k=[],q=[],f=0;f<b.bymonthday.length;f++)l=b.bymonthday[f],0<l?k.push(l):0>l&&q.push(l);b.bymonthday=k;b.bynmonthday=q}else 0>b.bymonthday?(b.bynmonthday=[b.bymonthday],b.bymonthday=[]):(b.bynmonthday=
[],b.bymonthday=[b.bymonthday]);null===b.byweekno||b.byweekno instanceof Array||(b.byweekno=[b.byweekno]);if(null===b.byweekday)b.bynweekday=null;else if("number"==typeof b.byweekday)b.byweekday=[b.byweekday],b.bynweekday=null;else if(b.byweekday instanceof B)!b.byweekday.n||b.freq>h.MONTHLY?(b.byweekday=[b.byweekday.weekday],b.bynweekday=null):(b.bynweekday=[[b.byweekday.weekday,b.byweekday.n]],b.byweekday=null);else{l=[];k=[];for(f=0;f<b.byweekday.length;f++)q=b.byweekday[f],"number"==typeof q?
l.push(q):!q.n||b.freq>h.MONTHLY?l.push(q.weekday):k.push([q.weekday,q.n]);b.byweekday=v(l)?l:null;b.bynweekday=v(k)?k:null}null===b.byhour?b.byhour=b.freq<h.HOURLY?[b.dtstart.getHours()]:null:"number"==typeof b.byhour&&(b.byhour=[b.byhour]);null===b.byminute?b.byminute=b.freq<h.MINUTELY?[b.dtstart.getMinutes()]:null:"number"==typeof b.byminute&&(b.byminute=[b.byminute]);null===b.bysecond?b.bysecond=b.freq<h.SECONDLY?[b.dtstart.getSeconds()]:null:"number"==typeof b.bysecond&&(b.bysecond=[b.bysecond]);
if(b.freq>=h.HOURLY)this.timeset=null;else{this.timeset=[];for(f=0;f<b.byhour.length;f++)for(l=b.byhour[f],k=0;k<b.byminute.length;k++)for(var q=b.byminute[k],m=0;m<b.bysecond.length;m++)this.timeset.push(new n.Time(l,q,b.bysecond[m]));n.sort(this.timeset)}};h.FREQUENCIES="YEARLY MONTHLY WEEKLY DAILY HOURLY MINUTELY SECONDLY".split(" ");h.YEARLY=0;h.MONTHLY=1;h.WEEKLY=2;h.DAILY=3;h.HOURLY=4;h.MINUTELY=5;h.SECONDLY=6;h.MO=new B(0);h.TU=new B(1);h.WE=new B(2);h.TH=new B(3);h.FR=new B(4);h.SA=new B(5);
h.SU=new B(6);h.DEFAULT_OPTIONS={freq:null,dtstart:null,interval:1,wkst:h.MO,count:null,until:null,bysetpos:null,bymonth:null,bymonthday:null,byyearday:null,byweekno:null,byweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null};h.parseText=function(a,c){return C().parseText(a,c)};h.fromText=function(a,c){return C().fromText(a,c)};h.optionsToString=function(a){var c,d,e,g,b,f=[];d=Object.keys(a);e=Object.keys(h.DEFAULT_OPTIONS);for(var l=0;l<d.length;l++)if(w(e,d[l])&&(c=d[l].toUpperCase(),
g=a[d[l]],b=[],!(null===g||g instanceof Array&&!g.length))){switch(c){case "FREQ":g=h.FREQUENCIES[a.freq];break;case "WKST":g=g.toString();break;case "BYWEEKDAY":c="BYDAY";g instanceof Array||(g=[g]);for(var k,q=0;q<g.length;q++)k=g[q],k instanceof B||(k=k instanceof Array?new B(k[0],k[1]):new B(k)),b[q]=k.toString();g=b;break;case "DTSTART":case "UNTIL":g=n.timeToUntilString(g);break;default:if(g instanceof Array){for(q=0;q<g.length;q++)b[q]=String(g[q]);g=b}else g=String(g)}f.push([c,g])}a=[];for(l=
0;l<f.length;l++)c=f[l],a.push(c[0]+"="+c[1].toString());return a.join(";")};h.prototype={all:function(a){if(a)return this._iter(new Q("all",{},a));a=this._cacheGet("all");!1===a&&(a=this._iter(new F("all",{})),this._cacheAdd("all",a));return a},between:function(a,c,d,e){a={before:c,after:a,inc:d};if(e)return this._iter(new Q("between",a,e));e=this._cacheGet("between",a);!1===e&&(e=this._iter(new F("between",a)),this._cacheAdd("between",e,a));return e},before:function(a,c){var d={dt:a,inc:c},e=this._cacheGet("before",
d);!1===e&&(e=this._iter(new F("before",d)),this._cacheAdd("before",e,d));return e},after:function(a,c){var d={dt:a,inc:c},e=this._cacheGet("after",d);!1===e&&(e=this._iter(new F("after",d)),this._cacheAdd("after",e,d));return e},count:function(){return this.all().length},toString:function(){return h.optionsToString(this.origOptions)},toText:function(a,c){return C().toText(this,a,c)},isFullyConvertibleToText:function(){return C().isFullyConvertible(this)},_cacheAdd:function(a,c,d){this._cache&&(c&&
(c=c instanceof Date?n.clone(c):n.cloneDates(c)),"all"==a?this._cache.all=c:(d._value=c,this._cache[a].push(d)))},_cacheGet:function(a,c){if(!this._cache)return!1;var d=!1;if("all"==a)d=this._cache.all;else{var e,g=0;a:for(;g<this._cache[a].length;g++){e=this._cache[a][g];for(var b in c)if(c.hasOwnProperty(b)&&String(c[b])!=String(e[b]))continue a;d=e._value;break}}if(!d&&this._cache.all){d=new F(a,c);for(g=0;g<this._cache.all.length&&d.accept(this._cache.all[g]);g++);d=d.getValue();this._cacheAdd(a,
d,c)}return d instanceof Array?n.cloneDates(d):d instanceof Date?n.clone(d):d},clone:function(){return new h(this.origOptions)},_iter:function(a){var c=this.options.dtstart,d=c.getFullYear(),e=c.getMonth()+1,g=c.getDate(),b=c.getHours(),f=c.getMinutes(),l=c.getSeconds(),k=n.getWeekday(c);n.getYearDay(c);var q=this.options.freq,m=this.options.interval,p=this.options.wkst,y=this.options.until,B=this.options.bymonth,E=this.options.byweekno,C=this.options.byyearday,F=this.options.byweekday,U=this.options.byeaster,
P=this.options.bymonthday,Q=this.options.bynmonthday,ca=this.options.bysetpos,M=this.options.byhour,R=this.options.byminute,Y=this.options.bysecond,r=new G(this);r.rebuild(d,e);var H={};H[h.YEARLY]=r.ydayset;H[h.MONTHLY]=r.mdayset;H[h.WEEKLY]=r.wdayset;H[h.DAILY]=r.ddayset;H[h.HOURLY]=r.ddayset;H[h.MINUTELY]=r.ddayset;H[h.SECONDLY]=r.ddayset;var H=H[q],t;if(q<h.HOURLY)t=this.timeset;else{var J={};J[h.HOURLY]=r.htimeset;J[h.MINUTELY]=r.mtimeset;J[h.SECONDLY]=r.stimeset;J=J[q];t=q>=h.HOURLY&&v(M)&&
!w(M,b)||q>=h.MINUTELY&&v(R)&&!w(R,f)||q>=h.SECONDLY&&v(Y)&&!w(Y,f)?[]:J.call(r,b,f,l)}for(var u,K=0,S=this.options.count,z,x,N,A,L,V,Z,aa;;){A=H.call(r,d,e,g);V=A[0];Z=A[1];aa=A[2];u=!1;for(x=Z;x<aa;x++)if(z=V[x],v(B)&&!w(B,r.mmask[z])||v(E)&&!r.wnomask[z]||v(F)&&!w(F,r.wdaymask[z])||v(r.nwdaymask)&&!r.nwdaymask[z]||null!==U&&!w(r.eastermask,z)||(v(P)||v(Q))&&!w(P,r.mdaymask[z])&&!w(Q,r.nmdaymask[z])||v(C)&&(z<r.yearlen&&!w(C,z+1)&&!w(C,-r.yearlen+z)||z>=r.yearlen&&!w(C,z+1-r.yearlen)&&!w(C,-r.nextyearlen+
z-r.yearlen)))V[z]=null,u=!0;if(v(ca)&&v(t)){var W,X=[];z;for(x=0;x<ca.length;x++){L=ca[x];0>L?(W=Math.floor(L/t.length),L=D(L,t.length)):(W=Math.floor((L-1)/t.length),L=D(L-1,t.length));try{A=[];for(N=Z;N<aa;N++){var T=V[N];null!==T&&A.push(T)}z=0>W?A.slice(W)[0]:A[W];var da=t[L],ea=n.fromOrdinal(r.yearordinal+z),I=n.combine(ea,da);w(X,I)||X.push(I)}catch(ba){}}n.sort(X);for(x=0;x<X.length;x++){I=X[x];if(y&&I>y)return this._len=K,a.getValue();if(I>=c){++K;if(!a.accept(I))return a.getValue();if(S&&
(--S,!S))return this._len=K,a.getValue()}}}else for(x=Z;x<aa;x++)if(z=V[x],null!==z)for(ea=n.fromOrdinal(r.yearordinal+z),N=0;N<t.length;N++){da=t[N];I=n.combine(ea,da);if(y&&I>y)return this._len=K,a.getValue();if(I>=c){++K;if(!a.accept(I))return a.getValue();if(S&&(--S,!S))return this._len=K,a.getValue()}}x=!1;if(q==h.YEARLY){d+=m;if(d>n.MAXYEAR)return this._len=K,a.getValue();r.rebuild(d,e)}else if(q==h.MONTHLY){e+=m;if(12<e&&(u=Math.floor(e/12),e=A=D(e,12),d+=u,0==e&&(e=12,--d),d>n.MAXYEAR))return this._len=
K,a.getValue();r.rebuild(d,e)}else if(q==h.WEEKLY)g=p>k?g+(-(k+1+(6-p))+7*m):g+(-(k-p)+7*m),k=p,x=!0;else if(q==h.DAILY)g+=m,x=!0;else if(q==h.HOURLY){for(u&&(b+=Math.floor((23-b)/m)*m);b+=m,t=O(b,24),u=t.div,A=t.mod,u&&(b=A,g+=u,x=!0),v(M)&&!w(M,b););t=J.call(r,b,f,l)}else if(q==h.MINUTELY){for(u&&(f+=Math.floor((1439-(60*b+f))/m)*m);f+=m,t=O(f,60),u=t.div,A=t.mod,u&&(f=A,b+=u,t=O(b,24),u=t.div,A=t.mod,u&&(b=A,g+=u,x=!0)),v(M)&&!w(M,b)||v(R)&&!w(R,f););t=J.call(r,b,f,l)}else if(q==h.SECONDLY){for(u&&
(l+=Math.floor((86399-(3600*b+60*f+l))/m)*m);l+=m,t=O(l,60),u=t.div,A=t.mod,u&&(l=A,f+=u,t=O(f,60),u=t.div,A=t.mod,u&&(f=A,b+=u,t=O(b,24),u=t.div,A=t.mod,u&&(b=A,g+=u,x=!0))),v(M)&&!w(M,b)||v(R)&&!w(R,f)||v(Y)&&!w(Y,l););t=J.call(r,b,f,l)}if(x&&28<g&&(u=n.monthRange(d,e-1)[1],g>u)){for(;g>u;){g-=u;++e;if(13==e&&(e=1,++d,d>n.MAXYEAR))return this._len=K,a.getValue();u=n.monthRange(d,e-1)[1]}r.rebuild(d,e)}}}};h.parseString=function(a){a=a.replace(/^\s+|\s+$/,"");if(!a.length)return null;var c,d,e,g=
a.split(";"),b={};for(a=0;a<g.length;a++)switch(c=g[a].split("="),d=c[0],e=c[1],d){case "FREQ":b.freq=h[e];break;case "WKST":b.wkst=h[e];break;case "COUNT":case "INTERVAL":case "BYSETPOS":case "BYMONTH":case "BYMONTHDAY":case "BYYEARDAY":case "BYWEEKNO":case "BYHOUR":case "BYMINUTE":case "BYSECOND":if(-1!=e.indexOf(","))for(e=e.split(","),c=0;c<e.length;c++)/^[+-]?\d+$/.test(e[c])&&(e[c]=Number(e[c]));else/^[+-]?\d+$/.test(e)&&(e=Number(e));d=d.toLowerCase();b[d]=e;break;case "BYDAY":var f;e=e.split(",");
b.byweekday=[];for(c=0;c<e.length;c++)f=e[c],2==f.length?(f=h[f],b.byweekday.push(f)):(f=f.match(/^([+-]?\d)([A-Z]{2})$/),d=Number(f[1]),f=f[2],f=h[f].weekday,b.byweekday.push(new B(f,d)));break;case "DTSTART":b.dtstart=n.untilStringToDate(e);break;case "UNTIL":b.until=n.untilStringToDate(e);break;case "BYEASTER":b.byeaster=Number(e);break;default:throw Error("Unknown RRULE property '"+d+"'");}return b};h.fromString=function(a){return new h(h.parseString(a))};var G=function(a){this.rrule=a;this.eastermask=
this.nwdaymask=this.wnomask=this.wdaymask=this.nmdaymask=this.mdaymask=this.mrange=this.mmask=this.yearweekday=this.yearordinal=this.nextyearlen=this.yearlen=this.lastmonth=this.lastyear=null};G.prototype.easter=function(a,c){var d=a%19,e=Math.floor(a/100),g=a%100,b=Math.floor(19*d+e-Math.floor(e/4)-Math.floor((e-Math.floor((e+8)/25)+1)/3)+15)%30,e=Math.floor(32+e%4*2+2*Math.floor(g/4)-b-g%4)%7,d=Math.floor((d+11*b+22*e)/451),b=Date.UTC(a,Math.floor((b+e-7*d+114)/31)-1,(b+e-7*d+114)%31+1+(c||0)),
d=Date.UTC(a,0,1);return[Math.ceil((b-d)/864E5)]};G.prototype.rebuild=function(a,c){var d=this.rrule;if(a!=this.lastyear){this.yearlen=n.isLeapYear(a)?366:365;this.nextyearlen=n.isLeapYear(a+1)?366:365;var e=new Date(a,0,1);this.yearordinal=n.toOrdinal(e);this.yearweekday=n.getWeekday(e);var g=n.getWeekday(new Date(a,0,1));365==this.yearlen?(this.mmask=[].concat(ga),this.mdaymask=[].concat(ja),this.nmdaymask=[].concat(la),this.wdaymask=fa.slice(g),this.mrange=[].concat(na)):(this.mmask=[].concat(ha),
this.mdaymask=[].concat(ia),this.nmdaymask=[].concat(ka),this.wdaymask=fa.slice(g),this.mrange=[].concat(ma));if(v(d.options.byweekno)){this.wnomask=p(0,this.yearlen+7);var b,f,e=b=D(7-this.yearweekday+d.options.wkst,7);4<=e?(e=0,f=this.yearlen+D(this.yearweekday-d.options.wkst,7)):f=this.yearlen-e;var l=Math.floor(f/7);f=D(f,7);for(var g=Math.floor(l+f/4),k,l=0;l<d.options.byweekno.length;l++)if(k=d.options.byweekno[l],0>k&&(k+=g+1),0<k&&k<=g)for(1<k?(k=e+7*(k-1),e!=b&&(k-=7-b)):k=e,f=0;7>f&&(this.wnomask[k]=
1,k++,this.wdaymask[k]!=d.options.wkst);f++);if(w(d.options.byweekno,1)&&(k=e+7*g,e!=b&&(k-=7-b),k<this.yearlen))for(l=0;7>l&&(this.wnomask[k]=1,k+=1,this.wdaymask[k]!=d.options.wkst);l++);if(e&&(w(d.options.byweekno,-1)?l=-1:(l=n.getWeekday(new Date(a-1,0,1)),f=D(7-l+d.options.wkst,7),b=n.isLeapYear(a-1)?366:365,l=4<=f?Math.floor(52+D(b+D(l-d.options.wkst,7),7)/4):Math.floor(52+D(this.yearlen-e,7)/4)),w(d.options.byweekno,l)))for(k=0;k<e;k++)this.wnomask[k]=1}else this.wnomask=null}if(v(d.options.bynweekday)&&
(c!=this.lastmonth||a!=this.lastyear)){e=[];if(d.options.freq==h.YEARLY)if(v(d.options.bymonth))for(l=0;l<d.options.bymonth.length;l++)c=d.options.bymonth[l],e.push(this.mrange.slice(c-1,c+1));else e=[[0,this.yearlen]];else d.options.freq==h.MONTHLY&&(e=[this.mrange.slice(c-1,c+1)]);if(v(e))for(this.nwdaymask=p(0,this.yearlen),l=0;l<e.length;l++){f=e[l];b=f[0];var m=f[1];--m;for(f=0;f<d.options.bynweekday.length;f++)g=d.options.bynweekday[f][0],k=d.options.bynweekday[f][1],0>k?(k=m+7*(k+1),k-=D(this.wdaymask[k]-
g,7)):(k=b+7*(k-1),k+=D(7-this.wdaymask[k]+g,7)),b<=k&&k<=m&&(this.nwdaymask[k]=1)}this.lastyear=a;this.lastmonth=c}null!==d.options.byeaster&&(this.eastermask=this.easter(a,d.options.byeaster))};G.prototype.ydayset=function(a,c,d){return[E(this.yearlen),0,this.yearlen]};G.prototype.mdayset=function(a,c,d){a=p(null,this.yearlen);d=this.mrange[c-1];c=this.mrange[c];for(var e=d;e<c;e++)a[e]=e;return[a,d,c]};G.prototype.wdayset=function(a,c,d){var e=p(null,this.yearlen+7);c=a=n.toOrdinal(new Date(a,
c-1,d))-this.yearordinal;for(d=0;7>d&&(e[a]=a,++a,this.wdaymask[a]!=this.rrule.options.wkst);d++);return[e,c,a]};G.prototype.ddayset=function(a,c,d){var e=p(null,this.yearlen);a=n.toOrdinal(new Date(a,c-1,d))-this.yearordinal;e[a]=a;return[e,a,a+1]};G.prototype.htimeset=function(a,c,d){for(var e=[],g=this.rrule,b=0;b<g.options.byminute.length;b++){c=g.options.byminute[b];for(var f=0;f<g.options.bysecond.length;f++)d=g.options.bysecond[f],e.push(new n.Time(a,c,d))}n.sort(e);return e};G.prototype.mtimeset=
function(a,c,d){for(var e=[],g=this.rrule,b=0;b<g.options.bysecond.length;b++)d=g.options.bysecond[b],e.push(new n.Time(a,c,d));n.sort(e);return e};G.prototype.stimeset=function(a,c,d){return[new n.Time(a,c,d)]};var F=function(a,c){this.init(a,c)};F.prototype={init:function(a,c){this.method=a;this.args=c;this._result=[];this.maxDate=this.minDate=null;"between"==a?(this.maxDate=c.inc?c.before:new Date(c.before.getTime()-1),this.minDate=c.inc?c.after:new Date(c.after.getTime()+1)):"before"==a?this.maxDate=
c.inc?c.dt:new Date(c.dt.getTime()-1):"after"==a&&(this.minDate=c.inc?c.dt:new Date(c.dt.getTime()+1))},accept:function(a){var c=this.minDate&&a<this.minDate,d=this.maxDate&&a>this.maxDate;if("between"==this.method){if(c)return!0;if(d)return!1}else if("before"==this.method){if(d)return!1}else if("after"==this.method){if(c)return!0;this.add(a);return!1}return this.add(a)},add:function(a){this._result.push(a);return!0},getValue:function(){switch(this.method){case "all":case "between":return this._result;
case "before":case "after":return this._result.length?this._result[this._result.length-1]:null}}};var Q=function(a,c,d){if(!w(["all","between"],a))throw Error('Invalid method "'+a+'". Only all and between works with iterator.');this.add=function(a){return d(a,this._result.length)?(this._result.push(a),!0):!1};this.init(a,c)};Q.prototype=F.prototype;ba&&(module.exports={RRule:h});"undefined"===typeof ender&&(T.RRule=h);"function"===typeof define&&define.amd&&define("rrule",[],function(){return h})})(this);
