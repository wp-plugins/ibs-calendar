function ibs_util_19(){return"AIzaSyBwcmfwl7W1aMyo9wnXwmASRfZ0sOhGhRc"}function IsEmail(a){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)}function CalendarObj(a,e,h){this.init(e,h)}
(function(a){CalendarObj.prototype.init=function(e,h){var c=this;this.args=e;this.mode=h;this.id=e.id;this.calendar=a("#fullcalendar-"+this.id);this.options={id:"1",feeds:{},ajaxUrl:null,ajaxData:null};for(var k in e)"undefined"!==typeof this.options[k]&&(this.options[k]=e[k]);this.qtip_params=function(d){var b=c.fullcalendar_options.timeFormat,a="";"undefined"!==typeof d.location&&""!==d.location&&(a="<p>Location: "+d.location+"</p>");var f="";"undefined"!==typeof d.description&&""!==d.description&&
(f="<p>"+d.description+"</p>");b=moment(d.start).format("ddd MMM DD "+b)+moment(d.end).format(" - "+b);d.allDay&&(b=moment(d.start).format("ddd MMM DD")+"  All day");return{content:{text:"<p>"+d.title+"</p>"+a+f+"<p>"+b+"</p>"},position:{my:"bottom center",at:"top center"},style:{classes:e.qtip.style+" "+e.qtip.rounded+e.qtip.shadow},show:{event:"mouseover"},hide:{fixed:!0,delay:250,event:"mouseout mouseleave"}}};this.fullcalendar_options={timezone:"local",height:null,theme:!0,firstDay:"1",weekends:!0,
lang:"en_us",timeFormat:"hh:mm a",titleFormat:"YYYY MMM DD",dayNamesShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),defaultView:"month",eventLimit:6,eventLimitClick:"popover",aspectRatio:1,editable:!1,hiddenDays:"",fixedWeekCount:!0,weekNumbers:!1,defaultDate:moment()};for(k in e)"undefined"!==typeof this.fullcalendar_options[k]&&""!==e[k]&&(this.fullcalendar_options[k]=e[k]);this.fullcalendar_options.header={left:e.headerLeft,center:e.headerCenter,right:e.headerRight};this.fullcalendar_options.loading=
function(d){if(d&&"widget"!==h){d=a("#fullcalendar-"+c.options.id).position();var b=a("#fullcalendar-"+c.options.id).width(),e=a("#fullcalendar-"+c.options.id).height();a("#ibs-loading-"+c.options.id).css({left:d.left,top:d.top,width:b,height:e}).show()}else a("#ibs-loading-"+c.options.id).hide()};this.fullcalendar_options.eventRender=function(a,b,q){("widget"===h||e.hideTitle)&&b.css("color",b.css("background-color"));b.css("cursor","pointer");"admin"===h&&"month"!==q.name||b.qtip(c.qtip_params(a))};
this.fullcalendar_options.eventClick=function(a,b,c){if(a.url)return window.open(a.url),!1};this.fullcalendar_options.dayClick=function(a,b,c){};this.fullcalendar_options.eventAfterAllRender=function(d){if("none"!==e.event_list&&a("#list-display-"+c.id).is(":checked")){d="#event-table-"+c.id;var b=a("#fullcalendar-"+c.id).fullCalendar("clientEvents");b.sort(function(a,b){return moment(a.start)-moment(b.start)});var q=[];if(!1===e.list_past||!1===e.list_repeat){for(var f=0;f<b.length;f++)if("string"!==
typeof b[f].repeat||null===b[f].repeat||""===b[f].repeat||!1!==e.list_repeat)!1===e.list_past&&moment()>moment(b[f].start)||q.push(b[f]);b=q}b=b.slice(0,e.list_max);a(d).empty();if("widget"!==h)for(a(d).css({border:"1px solid silver"}).append(a("<tbody>").append(a("<tr>").addClass("ui-widget-header").append(a("<th>").text("Day").css("padding","3px")).append(a("<th>").text("Time").css("padding","3px")).append(a("<th>").text("Event").css("padding","3px")).append(a("<th>").text("Location").css("padding",
"3px")))),f=0;f<b.length;f++){var q=moment()>moment(b[f].start)?"*":"",u=moment(b[f].start).format("ddd Do"),k=moment(b[f].start).format(c.fullcalendar_options.timeFormat);a(d).find("tbody").append(a("<tr>").attr({disabled:q}).append(a("<td>").text(u).css("padding","3px")).append(a("<td>").text(k).css("padding","3px")).append(a("<td>").append(a("<a>").attr({href:b[f].url,target:"_blank"}).html(q+b[f].title))).append(a("<td>").text(b[f].location).css("padding","3px")))}else for(a(d).css({border:"1px solid silver"}).append(a("<tbody>").append(a("<tr>").addClass("ui-widget-header").append(a("<th>").text("Events").css("padding",
"3px")))),f=0;f<b.length;f++)q=moment()>moment(b[f].start)?"*":"",a(d).find("tbody").append(a("<tr>").qtip(c.qtip_params(b[f])).append(a("<td>").append(a("<a>").attr({href:b[f].url,target:"_blank"}).html(q+b[f].title))))}};this.renderCalendar=function(){"none"===e.event_list?a("#list-display-"+c.id).parent().css("display","none"):a("#list-display-"+c.id).prop("checked","show"===e.event_list);this.calendar.fullCalendar(this.fullcalendar_options);for(var d in this.options.feeds)if(""!==this.options.feeds[d].url&&
this.options.feeds[d].enabled){var b={googleCalendarApiKey:function(){return"string"===typeof c.options.feeds[d].key&&""!==c.options.feeds[d].key?c.options.feeds[d].key:ibs_util_19()},textColor:this.options.feeds[d].textColor,backgroundColor:this.options.feeds[d].backgroundColor,url:this.options.feeds[d].url,googleCalendarId:IsEmail(this.options.feeds[d].url)?this.options.feeds[d].url:null};this.calendar.fullCalendar("addEventSource",b)}e.ibsEvents&&this.calendar.fullCalendar("addEventSource",{events:function(a,
b,d,e){d=[];for(var k in c.ibs_events){var g=c.ibs_events[k];if(0==g.recurr){var l,m,h,r;l=a.unix();m=b.unix();h=moment(g.start).unix();r=moment(g.end).unix();(h>=l&&r<=m||r>l&&r<m||h>=l&&h<=m||l>=h&&m<=r)&&d.push(g)}else{l=[];if(g.exceptions){l=g.exceptions.split(",");for(var n in l)l[n]=moment(l[n]).startOf("day")}m=(new RRule(RRule.parseString(g.repeat))).between(a.toDate(),b.toDate());for(n in m)m[n]=moment(m[n]).startOf("day");h=moment(g.end).diff(moment(g.start),"seconds");r=moment(g.start).unix()-
moment(g.start).startOf("day").unix();for(n in m){var p;a:{p=n;var t=void 0;for(t in l)if(0===l[t].diff(m[p])){p=!0;break a}p=!1}p||(p=m[n].startOf("day"),p={start:p.add(r,"seconds").format(),end:p.add(h,"seconds").format(),id:g.id,title:g.title,allDay:g.allDay,color:g.color,textColor:g.textColor,description:g.description,url:g.url,repeat:g.repeat,exceptions:g.exceptions},d.push(p))}}for(n in d)d[n].textColor="#ffffff",d[n].editable=!1}e(d)}});"none"!==e.event_list&&("show"===e.event_list&&a("#event-list-"+
c.id).show(),a("#list-display-"+c.id).click(function(b){a("#list-display-"+c.id).is(":checked")?(a("#fullcalendar-"+c.id).fullCalendar("rerenderEvents"),a("#event-list-"+c.id).show()):a("#event-list-"+c.id).hide()}))};e.ibsEvents?a.get(c.options.ajaxUrl,{action:"ibs_calendar_get_events",cache:!1,dataType:"json"}).then(function(a){if(""!==a){a=decodeURIComponent(a);c.ibs_events=JSON.parse(a);for(var b in c.ibs_events)c.ibs_events[b].title=jQuery("<div>").html(c.ibs_events[b].title).text(),c.ibs_events[b].description=
jQuery("<div>").html(c.ibs_events[b].description).text(),c.ibs_events[b].editable=!1,c.ibs_events[b].start=moment.unix(parseInt(c.ibs_events[b].start)).format(),c.ibs_events[b].end=moment.unix(parseInt(c.ibs_events[b].end)).format();console.log("IBS Events loaded.")}else c.ibs_events=[];c.renderCalendar()},function(){console.log("Get IBS Events failed.")}):c.renderCalendar()}})(jQuery);
