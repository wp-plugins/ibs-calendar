function ibs_util_19(){return"AIzaSyBwcmfwl7W1aMyo9wnXwmASRfZ0sOhGhRc"}function IsEmail(a){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)}function CalendarObj(a,d,h){this.init(d,h)}
(function(a){CalendarObj.prototype.init=function(d,h){var c=this;this.args=d;this.mode=h;this.id=d.id;this.ibs_events;this.calendar=a("#fullcalendar-"+this.id);this.options={id:"1",feeds:{},ajaxUrl:null,ajaxData:null};for(var l in d)"undefined"!==typeof this.options[l]&&(this.options[l]=d[l]);this.qtip_params=function(a){var b=c.fullcalendar_options.timeFormat,k="";"undefined"!==typeof a.location&&""!==a.location&&(k="<p>Location: "+a.location+"</p>");var e="";"undefined"!==typeof a.description&&
""!==a.description&&(e="<p>"+a.description+"</p>");b=moment(a.start).format("ddd MMM DD "+b)+moment(a.end).format(" - "+b);a.allDay&&(b=moment(a.start).format("ddd MMM DD")+"  All day");return{content:{text:"<p>"+a.title+"</p>"+k+e+"<p>"+b+"</p>"},position:{my:"bottom center",at:"top center"},style:{classes:d.qtip.style+" "+d.qtip.rounded+d.qtip.shadow},show:{event:"mouseover"},hide:{event:"mouseout mouseleave"}}};this.fullcalendar_options={timezone:"local",height:null,theme:!0,firstDay:"1",weekends:!0,
lang:"en_us",timeFormat:"hh:mm a",titleFormat:"YYYY MMM DD",dayNamesShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),defaultView:"month",eventLimit:6,eventLimitClick:"popover",aspectRatio:1,editable:!1,hiddenDays:"",fixedWeekCount:!0,weekNumbers:!1,defaultDate:moment()};for(l in d)"undefined"!==typeof this.fullcalendar_options[l]&&""!==d[l]&&(this.fullcalendar_options[l]=d[l]);this.fullcalendar_options.header={left:d.headerLeft,center:d.headerCenter,right:d.headerRight};this.fullcalendar_options.loading=
function(f){if(f&&"widget"!==h){f=a("#fullcalendar-"+c.options.id).position();var b=a("#fullcalendar-"+c.options.id).width(),d=a("#fullcalendar-"+c.options.id).height();a("#ibs-loading-"+c.options.id).css({left:f.left,top:f.top,width:b,height:d}).show()}else a("#ibs-loading-"+c.options.id).hide()};this.fullcalendar_options.eventRender=function(a,b,k){("widget"===h||d.hideTitle)&&b.css("color",b.css("background-color"));b.css("cursor","pointer");"admin"===h&&"month"!==k.name||b.qtip(c.qtip_params(a))};
this.fullcalendar_options.dayClick=function(d,b,k){if("widget"!==h)switch(k.name){case "month":a(c.calendar).fullCalendar("changeView","agendaWeek");a(c.calendar).fullCalendar("gotoDate",d);break;case "basicWeek":case "agendaWeek":a(c.calendar).fullCalendar("changeView","agendaDay"),a(c.calendar).fullCalendar("gotoDate",d)}};this.fullcalendar_options.eventAfterAllRender=function(f){if("none"!==d.event_list&&a("#list-display-"+c.id).is(":checked")){f="#event-table-"+c.id;var b=a("#fullcalendar-"+c.id).fullCalendar("clientEvents");
b.sort(function(a,b){return moment(a.start)-moment(b.start)});var k=[];if(!1===d.list_past||!1===d.list_repeat){for(var e=0;e<b.length;e++)if("string"!==typeof b[e].repeat||null===b[e].repeat||""===b[e].repeat||!1!==d.list_repeat)!1===d.list_past&&moment()>moment(b[e].start)||k.push(b[e]);b=k}b=b.slice(0,d.list_max);a(f).empty();if("widget"!==h)for(a(f).css({border:"1px solid silver"}).append(a("<tbody>").append(a("<tr>").addClass("ui-widget-header").append(a("<th>").text("Day").css("padding","3px")).append(a("<th>").text("Time").css("padding",
"3px")).append(a("<th>").text("Event").css("padding","3px")).append(a("<th>").text("Location").css("padding","3px")))),e=0;e<b.length;e++){var k=moment()>moment(b[e].start)?"*":"",u=moment(b[e].start).format("ddd Do"),l=moment(b[e].start).format(c.fullcalendar_options.timeFormat);a(f).find("tbody").append(a("<tr>").attr({disabled:k}).append(a("<td>").text(u).css("padding","3px")).append(a("<td>").text(l).css("padding","3px")).append(a("<td>").append(a("<a>").attr({href:b[e].url,target:"_blank"}).html(k+
b[e].title))).append(a("<td>").text(b[e].location).css("padding","3px")))}else for(a(f).css({border:"1px solid silver"}).append(a("<tbody>").append(a("<tr>").addClass("ui-widget-header").append(a("<th>").text("Events").css("padding","3px")))),e=0;e<b.length;e++)k=moment()>moment(b[e].start)?"*":"",a(f).find("tbody").append(a("<tr>").qtip(c.qtip_params(b[e])).append(a("<td>").append(a("<a>").attr({href:b[e].url,target:"_blank"}).html(k+b[e].title))))}};this.renderCalendar=function(){"none"===d.event_list?
a("#list-display-"+c.id).parent().css("display","none"):a("#list-display-"+c.id).prop("checked","show"===d.event_list);this.calendar.fullCalendar(this.fullcalendar_options);for(var f in this.options.feeds)if(""!==this.options.feeds[f].url&&this.options.feeds[f].enabled){var b={googleCalendarApiKey:function(){return"string"===typeof c.options.feeds[f].key&&""!==c.options.feeds[f].key?c.options.feeds[f].key:ibs_util_19()},textColor:this.options.feeds[f].textColor,backgroundColor:this.options.feeds[f].backgroundColor,
url:this.options.feeds[f].url,googleCalendarId:IsEmail(this.options.feeds[f].url)?this.options.feeds[f].url:null};this.calendar.fullCalendar("addEventSource",b)}d.ibsEvents&&this.calendar.fullCalendar("addEventSource",{events:function(a,b,d,f){d=[];for(var l in c.ibs_events){var g=c.ibs_events[l];if(0==g.recurr){var m,n,h,r;m=a.unix();n=b.unix();h=moment(g.start).unix();r=moment(g.end).unix();(h>=m&&r<=n||r>m&&r<n||h>=m&&h<=n||m>=h&&n<=r)&&d.push(g)}else{m=[];if(g.exceptions){m=g.exceptions.split(",");
for(var p in m)m[p]=moment(m[p]).startOf("day")}n=(new RRule(RRule.parseString(g.repeat))).between(a.toDate(),b.toDate());for(p in n)n[p]=moment(n[p]).startOf("day");h=moment(g.end).diff(moment(g.start),"seconds");r=moment(g.start).unix()-moment(g.start).startOf("day").unix();for(p in n){var q;a:{q=p;var t=void 0;for(t in m)if(0===m[t].diff(n[q])){q=!0;break a}q=!1}q||(q=n[p].startOf("day"),q={start:q.add(r,"seconds").format(),end:q.add(h,"seconds").format(),id:g.id,title:g.title,allDay:g.allDay,
color:g.color,textColor:g.textColor,description:g.description,url:g.url,repeat:g.repeat,exceptions:g.exceptions},d.push(q))}}for(p in d)d[p].textColor="#ffffff",d[p].editable=!1}f(d)}});"none"!==d.event_list&&("show"===d.event_list&&a("#event-list-"+c.id).show(),a("#list-display-"+c.id).click(function(b){a("#list-display-"+c.id).is(":checked")?(a("#fullcalendar-"+c.id).fullCalendar("rerenderEvents"),a("#event-list-"+c.id).show()):a("#event-list-"+c.id).hide()}))};d.ibsEvents?a.get(c.options.ajaxUrl,
{action:"ibs_calendar_get_events",cache:!1,dataType:"json"}).then(function(a){if(""!==a){a=decodeURIComponent(a);c.ibs_events=JSON.parse(a);for(var b in c.ibs_events)c.ibs_events[b].title=jQuery("<div>").html(c.ibs_events[b].title).text(),c.ibs_events[b].description=jQuery("<div>").html(c.ibs_events[b].description).text(),c.ibs_events[b].editable=!1,c.ibs_events[b].start=moment.unix(parseInt(c.ibs_events[b].start)).format(),c.ibs_events[b].end=moment.unix(parseInt(c.ibs_events[b].end)).format();console.log("IBS Events loaded.")}else c.ibs_events=
[];c.renderCalendar()},function(){console.log("Get IBS Events failed.")}):c.renderCalendar()}})(jQuery);
