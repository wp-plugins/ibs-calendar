(function(a){a.datepicker.parseDate=function(a,h){return moment(h,a).toDate()};a.datepicker.formatDate=function(a,h){return moment(h).format(a)};CalendarObj.prototype.editEvent=function(c){var h=this;a("#ibs-event-title").val(c.title);a("#ibs-event-allday").prop("checked",c.allDay);a(".color-box").each(function(b,e){rgb2hex(a(e).css("background-color"))===c.color&&a(e).trigger("click")});a("#ibs-event-color").val(c.color);a("#ibs-event-description").val(c.description);a("#ibs-event-location").val(c.location);
a(".repeat-option").addClass("repeat-not-active").find("input").prop("disabled",!0);c.repeat?(a("#ibs-event-repeat").val(c.repeat),a("#ibs-event-recurr").attr("checked",!0)):(a("#ibs-event-repeat").val(""),a("#ibs-event-recurr").attr("checked",!1));var f,k,b;"string"===typeof c.start?(f=c.start,c.start=moment(f)):f=c.start.format();"string"===typeof c.end?(k=c.end,c.end=moment(k)):k=c.end.format();c.allDay||null===c.end?(b=moment(f).startOf("day").toDate(),f=moment(f).endOf("day").toDate()):(b=moment(f).toDate(),
f=moment(k).toDate());a("#ibs-event-start-date").datepicker("setDate",b);a("#ibs-event-start-time").timepicker("setTime",b);a("#ibs-event-end-date").datepicker("setDate",f);a("#ibs-event-end-time").timepicker("setTime",f);a("#ibs-event-exception-div").empty();a(".event-allday").prop("disabled",c.allDay);b={autoOpen:!0,height:600,width:600,modal:!0,buttons:{Update:function(){c.wasRepeat=c.repeat?!0:!1;c.title=a("#ibs-event-title").val();c.color=rgb2hex(a(".color-box-selected").css("background-color"));
c.description=a("#ibs-event-description").val();c.location=a("#ibs-event-location").val();c.repeat=a("#ibs-event-repeat").val();if(c.exceptions){var b=[];a("input[name=repeat-exceptions]:checked").each(function(c,e){b.push(a(e).val())});c.exceptions=b.toString()}var e=a("#ibs-event-allday").is(":checked");if(!1===(c.allDay?e:!1)){var d=moment(a("#ibs-event-start-date").datepicker("getDate")).startOf("day"),g=a("#ibs-event-start-time").timepicker("getSecondsFromMidnight"),f=moment(a("#ibs-event-end-date").datepicker("getDate")).startOf("day"),
k=a("#ibs-event-end-time").timepicker("getSecondsFromMidnight");if(0>f.diff(d)){alert("end date cannot be before start date.");return}if(0===d.diff(f)&&k<=g){alert("end time cannot be before start time.");return}e?(c.start=d.startOf("day"),c.end=f.endOf("day")):(c.start=d.add(g,"seconds"),c.end=f.add(k,"seconds"));c.allDay=e?1:0}h.putEvent(c);a(this).dialog("close")},Delete:function(){0!==parseInt()&&confirm("Delete this event?")&&h.deleteEvent(c);a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},
open:function(){a("#event-title").focus()},close:function(){a(this).dialog("destroy")}};if(c.repeat&&(b.buttons={Update:b.buttons.Update,Exception:function(){confirm("Make  ["+a("#ibs-event-start-date").val()+"] an exception to the repeat rule?")&&(h.deleteEvent(c),a(this).dialog("close"))},Cancel:b.buttons.Cancel},c.exceptions)){f=c.exceptions.split(",").sort();k="";for(var e in f){var d=moment(f[e]).format("ddd MMM DD, YYYY");k+='<tr><td><input type="checkbox" name="repeat-exceptions" class="repeat-exceptions" value="'+
f[e]+'" checked/><td>'+d+"</td></tr>\n>"}a("#ibs-event-exception-div").append(a("<div>Exceptions - uncheck to remove an exception on update</div>")).append(a("<table>").append(a("<tbody>").append(k)))}a("#event-dialog").dialog(b)};CalendarObj.prototype.eventHTML=function(){var c=this,h=parseInt(this.fullcalendar_options.firstDay);a("#repeat-wkst").val(-1===h-1?6:h-1);var f=function(){var b={};b.freq=a("input[name=freq]:checked").val();b.interval=a("#repeat-interval").val();var c=[];a("input[name=byweekday]").each(function(b,
f){a(this).is(":checked")&&c.push(a(this).val())});b.byweekday=c;b.dtstart=a("#repeat-dtstart").val();b.count=a("#repeat-count").val();b.until=a("#repeat-until").val();b.wkst=a("#repeat-wkst").val();c=[];a("input[name=bymonth]").each(function(b,f){a(this).is(":checked")&&c.push(a(this).val())});b.bymonth=c;b.bysetpos=a("#repeat-bysetpos").val();b.bymonthday=a("#repeat-bymonthday").val();b.byyearday=a("#repeat-byyearday").val();b.byweekno=a("#repeat-byweekno").val();b.byhour=a("#repeat-byhour").val();
b.byminute=a("#repeat-byminute").val();b.bysecond=a("#repeat-bysecond").val();b.easter="";return b},k=function(){if(a("#ibs-event-recurr").is(":checked")){var b,c,d,h,k,p,g,m;m=f();delete m.radio_ends;h={};c=[RRule.MO,RRule.TU,RRule.WE,RRule.TH,RRule.FR,RRule.SA,RRule.SU];d=function(a){return c[a]};for(key in m)if(g=m[key])if("dtstart"===key||"until"===key?(b=new Date(Date.parse(g)),g=new Date(b.getTime()+6E4*b.getTimezoneOffset())):"byweekday"===key?g=g instanceof Array?g.map(d):d(g):/^by/.test(key)?
(!1===g instanceof Array&&(g=g.split(/[,\s]+/)),g=function(){var a,b,c;c=[];a=0;for(b=g.length;a<b;a++)(p=g[a])&&c.push(p);return c}(),g=g.map(function(a){return parseInt(a,10)})):g=parseInt(g,10),"wkst"===key&&(g=d(g)),"interval"!==key||1!==g&&g)h[key]=g;try{k=function(){return new RRule(h)}()}catch(q){console.log(q);return}b=k.toString();a("#ibs-event-repeat").val(b)}return""};a("#repeat-options").on("change","input",function(){var b=1<a("input[name=interval]").val()?"s":"";switch(a("input[name=freq]:checked").val()){case "3":a("#repeat-interval-type").text("day"+
b);break;case "2":a("#repeat-interval-type").text("week"+b);break;case "1":a("#repeat-interval-type").text("month"+b);break;case "0":a("#repeat-interval-type").text("year"+b)}k()});a("input[name=radio_ends]").click(function(b){switch(a(this).val()){case "never":a("input[name=until]").val("").attr("disabled",!0);a("input[name=count]").val("").attr("disabled",!0);break;case "until":a("input[name=until]").val("").attr("disabled",!1);a("input[name=count]").val("").attr("disabled",!0);a("#repeat-until").datepicker("setDate",
moment().toDate());break;case "count":a("input[name=until]").val("").attr("disabled",!0),a("input[name=count]").val("30").attr("disabled",!1)}k(this,"options")});a("#repeat-advanced").click(function(b){a(this).is(":checked")?a(".repeat-advanced").show():a(".repeat-advanced").hide()});a("#ibs-event-recurr").click(function(b){a(this).is(":checked")?(a(".repeat-option").removeClass("repeat-not-active").find("input").prop("disabled",!1),a("#repeat-dtstart").datepicker("setDate",moment().toDate()),a("#repeat-until").prop("disabled",
!0),k()):(a("#ibs-event-repeat").val(""),a("#ibs-event-exceptions").val(""),a(".repeat-option").addClass("repeat-not-active").find("input").prop("disabled",!0))});h={dateFormat:this.fullcalendar_options.titleFormat,onChange:k()};a("#repeat-until").datepicker(h);a("#repeat-dtstart").datepicker(h);a("#repeat-advanced").click(function(b){a(this).is(":checked")?a(".repeat-advanced").show():a(".repeat-advanced").hide()});a(".color-box").click(function(){a(".color-box").removeClass("color-box-selected");
a(this).addClass("color-box-selected")});a(".ibs-datepicker").datepicker({dateFormat:this.fullcalendar_options.titleFormat});a(".ibs-timepicker").timepicker({timeFormat:this.fullcalendar_options.timeFormat,step:15});a("#ibs-events-position").val(0);a(".ibs-events-paging").click(function(b){b=parseInt(a("#ibs-events-position").val());var e=parseInt(a("#ibs-events-limit").val());if(e<c.db.Events.length){switch(a.trim(a(this).text())){case "<<":b=0;break;case "<":b=0>b-e?0:b-e;break;case ">":b=b+e>c.db.Events.length-
e?c.db.Events.length-e:b+e;break;case ">>":b+e<=c.db.Events.length-e&&(b=c.db.Events.length-e)}a("#ibs-events-position").val(b)}c.showEvents(b,e)});a("#ibs-events-toggle").click(function(){switch(a(this).text()){case "All":a(".ibs-events-select").attr("checked",!0);a(this).text("None");a("#ibs-events-remove").attr("disabled",!1);break;case "None":a(".ibs-events-select").attr("checked",!1),a(this).text("All"),a("#ibs-events-remove").attr("disabled",!0)}});a("#ibs-events-remove").click(function(){a("#ibs-events-remove").attr("disabled",
!0);confirm("Delete selected events?")&&(a(".ibs-events-select").each(function(b,e){if(a(e).is(":checked"))for(var d in c.db.Events)if(c.db.Events[d].id===parseInt(a(e).val())){c.db.Events.splice(d,1);break}}),c.putDB());c.showEvents(0)});a("#ibs-events-add").click(function(){var a=c.getEvent(0);c.editEvent(a)});a("#ibs-event-allday").click(function(){a(this).is(":checked")?a(".event-allday").attr("disabled",!0):a(".event-allday").attr("disabled",!1)})};CalendarObj.prototype.showEvents=function(c,
h){var f=this,k=this.fullcalendar_options.titleFormat+" - "+this.fullcalendar_options.timeFormat;"undefined"===typeof c&&(c=parseInt(a("#ibs-events-position").val()));"undefined"===typeof h&&(h=parseInt(a("#ibs-events-limit").val()));var b=this.db.Events.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});a(".ibs-events-data-row").remove();for(var e=this.db.Events.length<=h?this.db.Events.length:h,d=c;d<c+e;d++){var n=moment(b[d].start),l=moment(b[d].end),l=moment.duration(l.diff(n)).humanize();
b[d].allDay&&(l="all day");b[d].repeat&&(l+=" >>");a("#ibs-events-table").append(a('<tr class="ibs-events-data-row">').append(a('<td class="ibs-events-td">').text(d+1).css("text-align","right")).append(a('<td class="ibs-events-td event-center"><input class="ibs-events-select" type="checkbox" value="'+b[d].id+'" />')).append(a('<td class="ibs-events-td">').text(b[d].title).css({"background-color":b[d].color,color:b[d].textColor})).append(a('<td class="ibs-events-td">').text(n.format(k))).append(a('<td class="ibs-events-td">').text(l)).append(a('<td class="ibs-events-td">').text(b[d].location)).append(a('<td class="ibs-events-td">').text(b[d].description.substring(0,
50))).append(a('<td class="ibs-events-td event-center">').html('<button href="#" class="event-edit" rel="'+b[d].id+'" title="edit event"><strong> ~ </strong></button>')))}a(".event-edit").on("click","",{},function(b){b=f.getEvent(parseInt(a(this).attr("rel")));b.start=moment(b.start);b.end=moment(b.end);f.editEvent(b)})}})(jQuery);
